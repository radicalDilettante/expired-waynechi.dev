<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Prevent to make instance repeatedly in react component - WayneChoi.dev</title><meta name="author" content="Wayne Choi"/><meta name="description" content="I had an issue to make instance repeatedly in react component, and fixed it."/><meta name="keywords" content="React,Issue"/><meta name="next-head-count" content="6"/><link rel="preload" href="https://waynechoi.dev/_next/static/css/aaedc6b3366e5497f17c.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/aaedc6b3366e5497f17c.css" data-n-g=""/><link rel="preload" href="https://waynechoi.dev/_next/static/css/356cb93e55a5c6167b29.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/356cb93e55a5c6167b29.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://waynechoi.dev/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="https://waynechoi.dev/_next/static/chunks/webpack-26d4ba47f3aad1b49b1b.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/main-c4f2541b93e4ae8b71f8.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/_app-4a215befa954bc3f5ab5.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/113-578803495dd2b122acd7.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/%5Bslug%5D-0605c348be7976fcc37d.js" defer=""></script><script src="https://waynechoi.dev/_next/static/Qk60vqpX8MxpFMHigYFYa/_buildManifest.js" defer=""></script><script src="https://waynechoi.dev/_next/static/Qk60vqpX8MxpFMHigYFYa/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="style_container__1fUIW"><header class="style_header__1vTJ4 theme_light__2lu4I"><div class="style_container__3a_wR"><div class="style_header__1ynE4"><button class="style_mobileMenuButton__1APOa"><img alt="open_menu_bar" src="https://waynechoi.dev/images/menu.svg"/></button><a class="style_name__c3MEE" href="/">WayneChoi.dev</a><ul class="style_list__chEFJ"><li><div><a href="/">HOME</a></div></li><li><div><a href="/about">ABOUT</a></div></li><li><div><a href="/portfolio">PORTFOLIO</a></div></li><li><button class="style_cliButton__3JcSL"><img src="https://waynechoi.dev/images/cli.png" alt="cli_mode"/></button></li></ul><div class="style_searchBar__FDBv7"><form class="style_container__j4rCB theme_light__2lu4I"><input type="text" id="keyword" placeholder="keywords..." required="" class="theme_light__2lu4I"/><button type="submit"><img alt="search" src="https://waynechoi.dev/images/search.svg"/></button></form></div><button class="style_mobileSearchButton__1AMGz"><img alt="open_search_bar" src="https://waynechoi.dev/images/search.svg"/></button></div></div></header><section class="style_contents__1dCqS"><div class="blog_container__2sPBE"><div class="blog_tagWrapper__1MSFu"><span class="blog_tag__3CYz_">#<!-- -->React</span><span class="blog_tag__3CYz_">#<!-- -->Issue</span></div><h1 class="blog_h1__3a0RO">Prevent to make instance repeatedly in react component</h1><span class="blog_date__3Pnjx">Dec 15, 2021</span><div class="blog_content__2NI78"><div></div></div></div></section><footer class="style_footer__1H40h">(C) <!-- -->2022<!-- -->. Wonjun Choi. All rights reserved.</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Prevent to make instance repeatedly in react component","date":"Dec 15, 2021","tag":["React","Issue"],"excerpt":"I had an issue to make instance repeatedly in react component, and fixed it.","content":"\nAll code is not real codes, but abstracted to understand this issue easily.\n\n```javascript\n// service/command.ts\nexport default class Command {\n  contentsContainer: HTMLDivElement;\n  posts: Post[];\n  curDir: string;\n\n  constructor(contentsContainer: HTMLDivElement, posts: Post[]) {\n    this.contentsContainer = contentsContainer;\n    this.posts = posts;\n    this.curDir = \"\";\n  }\n\n  cd() {\n    switch (this.curDir) {\n      case \"\":\n        this.curDir = \"/dir\";\n        break;\n\n      case \"/dir\":\n        this.curDir = \"\";\n        break;\n    }\n  }\n}\n\n// pages/cli.tsx\nexport default function Cli({ posts }: IProps) {\n\n  const [curDir, setCurDir] = useState(\"\");\n\n  const contentsElement = useRef\u003cHTMLDivElement\u003e(null);\n  const contentsContainer = contentsElement.current!;\n\n  const cliCommand = new Command(contentsContainer, posts);\n\n  const changeDirectory = () =\u003e {\n      cliCommand.cd(command);\n      setCurDir(cliCommand.curDir);\n  };\n  return (\n      ...\n  );\n}\n\nexport const getStaticProps: GetStaticProps = async () =\u003e {\n  const posts = getBlogList();\n  return {\n    props: {\n      posts,\n    },\n  };\n};\n\n```\n\nThis code is to implement cli command for my tech blog. It works well in unit testing, but I had an issue when user testing. Even if I change this.curDir member in cliCommand instance to the string \"/dir\", it keep changing to an empty string again.\n\nThe reason was the react component keep making new instance whenever the life cycle of itself was changed. I set the member, this.curDir, the empty string in constructor method, so it kept changing to empty string.\n\nI wanted to make an instance of Command class in the main component, \\_app.tsx, then inject the dependency into cli page component, but I can not access the arguments for constructor method, HTMLDivElement, and pages, in the main component. Because the business logic of getting pages need to access file system, but the main component of next.js was not supported for server-side.\n\n```javascript\n\n// service/command.ts\nexport default class Command {\n  contentsContainer!: HTMLDivElement;\n  posts!: Post[];\n  curDir: string;\n\n  constructor() {\n    this.curDir = \"\";\n  }\n\n  init(contentsContainer: HTMLDivElement, posts: Post[]) {\n    this.contentsContainer = contentsContainer;\n    this.posts = posts;\n  }\n\n  cd() {\n    switch (this.curDir) {\n      case \"\":\n        this.curDir = \"/dir\";\n        break;\n\n      case \"/dir\":\n        this.curDir = \"\";\n        break;\n    }\n  }\n}\n\n\n// pages/_app.tsx\nimport Command from \"../service/blog/command\";\n\nfunction MyApp({ Component, pageProps }: AppProps) {\n  const cliCommand = new Command();\n  return \u003cComponent {...pageProps} cliCommand={cliCommand} /\u003e\n}\n\nexport default MyApp;\n\n\n// pages/cli.tsx\nexport default function Cli({ cliCommand, posts }: IProps) {\n\n  const [curDir, setCurDir] = useState(\"\");\n\n  const contentsElement = useRef\u003cHTMLDivElement\u003e(null);\n  const contentsContainer = contentsElement.current!;\n\n  const changeDirectory = () =\u003e {\n      cliCommand.cd(command);\n      setCurDir(cliCommand.curDir);\n  };\n\n useEffect(() =\u003e {\n    cliCommand.init(contentsContainer, posts);\n  }, [contentsContainer, posts]);\n\n  return (\n      ...\n  );\n}\n\nexport const getStaticProps: GetStaticProps = async () =\u003e {\n  const posts = getBlogList();\n  return {\n    props: {\n      posts,\n    },\n  };\n};\n\n```\n\nTo figure it out, I removed all the arguments from the constructor method, and added an init method to set HTMLDivElement and pages members. Then I made an instance in main component, and pass it to the page component.\n"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"prevent_to_make_instance_repeatedly_in_react_component"},"buildId":"Qk60vqpX8MxpFMHigYFYa","assetPrefix":"https://waynechoi.dev","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>