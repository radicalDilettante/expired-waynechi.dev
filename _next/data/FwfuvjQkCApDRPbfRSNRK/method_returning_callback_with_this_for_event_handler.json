{"pageProps":{"title":"Method returning callback with this for event handler","date":"Apr 4, 2022","tag":["Web","Cookie","JavaScript"],"excerpt":"I met a trobule about this in a method returning callback for event handler. I fixed it with static method and other hack.","content":"\nAll code is not real codes, but abstracted to understand this issue easily.\n\n```TypeScript\nexport default class SignUpService {\n  private urlBase: string;\n\n  constructor(urlBase: string) {\n    this.urlBase = urlBase;\n  }\n\n  public usernameFilter = () => {\n    return async (username: string) => {\n      // skip\n\n      console.log(this.urlBase)\n      return `The username, ${username}, is already exist.`;\n    };\n  };\n}\n\n// this was undefined when usernameFilter method was called in event handler.\n```\n\nusernameFilter method return an async callback, and it is called in DOM event handler. this in event handler is unexpected and not under my control. In the case of this project, this was undefined.\n\n## Static Method\n\n```TypeScript\nexport default class SignUpService {\n\n  static usernameFilter = (urlBase: string) => {\n    return async (username: string) => {\n      // skip\n\n      console.log(urlBase)\n      return `The username, ${username}, is already exist.`;\n    };\n  };\n}\n```\n\nAt first, I made all methods static, and injected all dependency as a parameter. The code above is quite simple, but real code was not. There were plenty of duplicated codes.\n\nThat was not cool.\n\n## this in arrow function\n\nthis is set when execution of method or function. However, this in arrow function is set when the function is declared.\n\nThe async callback returned in usernameFilter method is declared in the rendering method of React library in this project. I am not sure how it works, and I could not help it.\n\n```TypeScript\nexport default class SignUpService {\n  private urlBase: string;\n\n  constructor(urlBase: string) {\n    this.urlBase = urlBase;\n  }\n\n  public usernameFilter = () => {\n    const urlBase = this.urlBase\n\n    return async (username: string) => {\n      // skip\n\n      console.log(urlBase)\n      return `The username, ${username}, is already exist.`;\n    };\n  };\n}\n```\n\nSo I re-declare member, I need, in usernameFilter methods, and use it in the callback returned. usernameFilter method is declared when making an instance of the class, so this should be the instance.\n"},"__N_SSG":true}