<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://waynechoi.dev/_next/static/css/4698f8d7382a455a8b5a.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/4698f8d7382a455a8b5a.css" data-n-g=""/><link rel="preload" href="https://waynechoi.dev/_next/static/css/65aafd2c08f9a166c309.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/65aafd2c08f9a166c309.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://waynechoi.dev/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="https://waynechoi.dev/_next/static/chunks/webpack-c6b64c99608fd9e03712.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/framework-44ddc888f4db0c68c97f.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/main-8af3309d1a9bc71624bc.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/_app-48b69efe9e5a5e13dc29.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/368-de82a9ffaf4175eeadb0.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/%5Bslug%5D-d7e1ef0b730854f2fc13.js" defer=""></script><script src="https://waynechoi.dev/_next/static/IcFg2rTd2QAX5NcgMIzP8/_buildManifest.js" defer=""></script><script src="https://waynechoi.dev/_next/static/IcFg2rTd2QAX5NcgMIzP8/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout_container__1ROar"><header class="layout_header__MPs9E"><div class="header_container__2Vvjg"><div class="header_header__3lGRs"><button class="header_mobileMenuButton__1vVY8"><img alt="menu" src="https://waynechoi.dev/images/menu.svg"/></button><a class="header_name__2PEvs" href="/">WayneChoi.dev</a><ul class="header_list__2sooW"><li class="header_item_list_item__33J-y"><a href="/">HOME</a></li><li class="header_item_list_item__33J-y"><a href="/about">ABOUT</a></li><li class="header_item_list_item__33J-y"><a href="/portfolio">PORTFOLIO</a></li></ul><div class="header_searchBar__3VAZB"><form class="search_bar_container__2559w"><input type="text" id="keyword" placeholder="keywords..." required=""/><button type="submit"><img alt="search" src="https://waynechoi.dev/images/search.svg"/></button></form></div><button class="header_mobileSearchButton__1r9xs"><img alt="search" src="https://waynechoi.dev/images/search.svg"/></button></div></div></header><section class="layout_contents__wGaub"><div class="blog_container__3EBzV"><div class="blog_tagWrapper__sYhAm"><span class="blog_tag__2jFK0">#<!-- -->React</span><span class="blog_tag__2jFK0">#<!-- -->Deploy</span></div><h1 class="blog_h1__3s5r-">Build Next.js blog and deploy to Github Pages</h1><span class="blog_date__2SU8B">Sep 10, 2021</span><div class="blog_content__mgCMi"><p>Next.js was known as a React framework to support server-side rendering (SSR) with zero config(if not necessary). After recent updates, it supports static generation (SSG) well, too.</p>
<p>To build my own blog, I got two options for React frameworks, one was Next.js, and other was Gatsby. I want to export my blog to static files, and Gatsby is specialized for SSG though, I choose Next.js. There was no reason for me to choose new tech stack, because I already tried Next.js before(for SSR), and I heard SSG in Next.js perform well.</p>
<p>I deployed the static files of my blog to Github Pages, and I needed some configuration. I would record how I build static blog site with Next.js, and general configuration to deploy to Github Pages in this post.</p>
<hr/>
<h2>Table of Contents</h2>
<ul>
<li>Write posts with markdown format</li>
<li>Get slugs from markdown files</li>
<li>define path list from slugs</li>
<li>Parse markdown to html</li>
<li>Configuration</li>
</ul>
<p>My code is modularized though, I put all code together in this post to make it easy to explain.</p>
<p>I will skip to import all libraries. The dependency is blow.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span> </span><span class="token" style="color:#690">&quot;dependencies&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;gh-pages&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;^3.2.3&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;gray-matter&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;^4.0.3&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;next&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;^11.1.2&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;react&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;17.0.2&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;react-dom&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;17.0.2&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;react-markdown&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;^6.0.3&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;react-syntax-highlighter&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;^15.4.4&quot;</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span></code></div></pre>
<hr/>
<h2>Get post list from markdown files</h2>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">getStaticProps</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#07a">const</span><span> files </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> fs</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">readdirSync</span><span class="token" style="color:#999">(</span><span>path</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">join</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;posts&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:slategray">// read file names from the directory</span><span>
</span><span>  </span><span class="token" style="color:slategray">// It returns an array</span><span>
</span>
<span>  </span><span class="token" style="color:#07a">const</span><span> posts </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> files</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">map</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">filename</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">const</span><span> slug </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> filename</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">replace</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;.md&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#07a">const</span><span> markdownWithMeta </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> fs</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">readFileSync</span><span class="token" style="color:#999">(</span><span>
</span><span>      path</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">join</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;posts&quot;</span><span class="token" style="color:#999">,</span><span> filename</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span>
</span><span>      </span><span class="token" style="color:#690">&quot;utf-8&quot;</span><span>
</span><span>    </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#07a">const</span><span> </span><span class="token" style="color:#999">{</span><span> data</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> frontMatter</span><span class="token" style="color:#999">,</span><span> content </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">matter</span><span class="token" style="color:#999">(</span><span>markdownWithMeta</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>      slug</span><span class="token" style="color:#999">,</span><span>
</span><span>      </span><span class="token spread" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">...</span><span>frontMatter
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:slategray">// iterate files to get slug, and parse frontMatter of markdown</span><span>
</span><span>  </span><span class="token" style="color:slategray">// use &quot;matter&quot; library to parse markdown</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    props</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>      posts</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token" style="color:slategray">// return props to React component</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token module" style="color:#07a">default</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token maybe-class-name" style="color:#DD4A68">Index</span><span class="token" style="color:#999">(</span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> posts </span><span class="token parameter" style="color:#999">}</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token spread" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">...</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>Now we got an array including slug of each posts. We can route pages with those slugs.</p>
<hr/>
<h2>Get static path from slug</h2>
<p>If a page has dynamic routes and uses getStaticProps it needs to define a list of paths that have to be rendered to HTML at build time.</p>
<p>If you export an async function called getStaticPaths from a page that uses dynamic routes, Next.js will statically pre-render all the paths specified by getStaticPaths.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// [slug].jsx</span><span>
</span><span></span><span class="token" style="color:slategray">// https://localhost:3000/slug</span><span>
</span>
<span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">getStaticPaths</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#07a">const</span><span> files </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> fs</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">readdirSync</span><span class="token" style="color:#999">(</span><span>path</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">join</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;posts&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>  </span><span class="token" style="color:#07a">const</span><span> paths </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> files</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">map</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token parameter">filename</span><span class="token" style="color:#999">)</span><span> </span><span class="token arrow" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span>    params</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>      slug</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> filename</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">replace</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;.md&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    paths</span><span class="token" style="color:#999">,</span><span>
</span><span>    fallback</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">,</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:slategray">// define a list of paths</span></code></div></pre>
<hr/>
<h2>Parse markdown to html and render</h2>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// [slug].jsx</span><span>
</span>
<span></span><span class="token spread" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">...</span><span>
</span>
<span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">getStaticProps</span><span class="token" style="color:#999">(</span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> params</span><span class="token parameter" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span class="token parameter"> </span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> slug </span><span class="token parameter" style="color:#999">}</span><span class="token parameter"> </span><span class="token parameter" style="color:#999">}</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#07a">const</span><span> markdownWithMeta </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> fs</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">readFileSync</span><span class="token" style="color:#999">(</span><span>
</span><span>    path</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">join</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;posts&quot;</span><span class="token" style="color:#999">,</span><span> slug </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> </span><span class="token" style="color:#690">&quot;.md&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#690">&quot;utf-8&quot;</span><span>
</span><span>  </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:slategray">// get a single markdown file with a slug</span><span>
</span>
<span>  </span><span class="token" style="color:#07a">const</span><span> </span><span class="token" style="color:#999">{</span><span> data</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> frontMatter</span><span class="token" style="color:#999">,</span><span> content </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">matter</span><span class="token" style="color:#999">(</span><span>markdownWithMeta</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:slategray">// parse the markdown file</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    props</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span> frontMatter</span><span class="token" style="color:#999">,</span><span> content </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:slategray">// return props to a React Component</span><span>
</span><span></span><span class="token" style="color:slategray">// content is html</span><span>
</span>
<span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token module" style="color:#07a">default</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token maybe-class-name" style="color:#DD4A68">Blog</span><span class="token" style="color:#999">(</span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> frontMatter</span><span class="token parameter" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span class="token parameter"> </span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> title </span><span class="token parameter" style="color:#999">}</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> content</span><span class="token parameter" style="color:#999">}</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">(</span><span>
</span><span>    </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span>div</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span>h1</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span class="token" style="color:#999">{</span><span>title</span><span class="token" style="color:#999">}</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span>h1</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span>div className</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span class="token" style="color:#999">{</span><span>styles</span><span class="token" style="color:#999">.</span><span class="token property-access">content</span><span class="token" style="color:#999">}</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token maybe-class-name">ReactMarkdown</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span class="token" style="color:#999">{</span><span>content</span><span class="token" style="color:#999">}</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span class="token maybe-class-name">ReactMarkdown</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span>div</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span>div</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:slategray">// Render html with &quot;markdown&quot; library</span></code></div></pre>
<hr/>
<h2>Configuration</h2>
<p>To generate static site, and deploy to CDN, we can set up an asset Prefix and configure the CDN&#x27;s origin to resolve to the domain that Next.js is hosted on.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// next.config.js</span><span>
</span>
<span></span><span class="token" style="color:#07a">const</span><span> isProd </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> process</span><span class="token" style="color:#999">.</span><span class="token property-access">env</span><span class="token" style="color:#999">.</span><span class="token" style="color:#905">NODE_ENV</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">===</span><span> </span><span class="token" style="color:#690">&quot;production&quot;</span><span class="token" style="color:#999">;</span><span>
</span>
<span>module</span><span class="token" style="color:#999">.</span><span class="token property-access">exports</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:slategray">// Use the CDN in production and localhost for development.</span><span>
</span><span>  assetPrefix</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> isProd </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">?</span><span> </span><span class="token" style="color:#690">&quot;https://cdn.mydomain.com&quot;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">;</span></code></div></pre>
<p>And I imported the assetPrest to fix image links between pages.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// _app.js</span><span>
</span>
<span></span><span class="token module" style="color:#07a">import</span><span> </span><span class="token imports" style="color:#999">{</span><span class="token imports"> assetPrefix </span><span class="token imports" style="color:#999">}</span><span> </span><span class="token module" style="color:#07a">from</span><span> </span><span class="token" style="color:#690">&quot;../next.config&quot;</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token maybe-class-name" style="color:#DD4A68">MyApp</span><span class="token" style="color:#999">(</span><span class="token parameter" style="color:#999">{</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Component</span><span class="token parameter" style="color:#999">,</span><span class="token parameter"> pageProps </span><span class="token parameter" style="color:#999">}</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#07a">const</span><span> date </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">Date</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#07a">return</span><span> </span><span class="token" style="color:#999">(</span><span>
</span><span>      </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token maybe-class-name">Component</span><span> </span><span class="token" style="color:#999">{</span><span class="token spread" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">...</span><span>pageProps</span><span class="token" style="color:#999">}</span><span> prefix</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span class="token" style="color:#999">{</span><span>assetPrefix</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token module" style="color:#07a">export</span><span> </span><span class="token module" style="color:#07a">default</span><span> </span><span class="token maybe-class-name">MyApp</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:slategray">// other pages</span><span>
</span><span></span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span>img src</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span class="token" style="color:#999">{</span><span>prefix </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> </span><span class="token" style="color:#690">&quot;imgSrc&quot;</span><span class="token" style="color:#999">}</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span></code></div></pre>
<hr/>
<h2>References</h2>
<ul>
<li><a href="https://nextjs.org/">https://nextjs.org/</a></li>
<li><a href="https://dev.to/jameswallis/deploying-a-next-js-app-to-github-pages-24pn">hhttps://dev.to/jameswallis/</a></li>
</ul></div></div></section><footer class="layout_footer__2KiKH">(C) <!-- -->2021<!-- -->. Wonjun Choi. All rights reserved.</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"Build Next.js blog and deploy to Github Pages","date":"Sep 10, 2021","tag":["React","Deploy"],"excerpt":"How I build static blog site with Next.js, and general configuration to deploy to Github Pages in this post... "},"content":"\r\nNext.js was known as a React framework to support server-side rendering (SSR) with zero config(if not necessary). After recent updates, it supports static generation (SSG) well, too.\r\n\r\nTo build my own blog, I got two options for React frameworks, one was Next.js, and other was Gatsby. I want to export my blog to static files, and Gatsby is specialized for SSG though, I choose Next.js. There was no reason for me to choose new tech stack, because I already tried Next.js before(for SSR), and I heard SSG in Next.js perform well.\r\n\r\nI deployed the static files of my blog to Github Pages, and I needed some configuration. I would record how I build static blog site with Next.js, and general configuration to deploy to Github Pages in this post.\r\n\r\n---\r\n\r\n## Table of Contents\r\n\r\n- Write posts with markdown format\r\n- Get slugs from markdown files\r\n- define path list from slugs\r\n- Parse markdown to html\r\n- Configuration\r\n\r\nMy code is modularized though, I put all code together in this post to make it easy to explain.\r\n\r\nI will skip to import all libraries. The dependency is blow.\r\n\r\n```javascript\r\n \"dependencies\": {\r\n    \"gh-pages\": \"^3.2.3\",\r\n    \"gray-matter\": \"^4.0.3\",\r\n    \"next\": \"^11.1.2\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n    \"react-markdown\": \"^6.0.3\",\r\n    \"react-syntax-highlighter\": \"^15.4.4\"\r\n  }\r\n```\r\n\r\n---\r\n\r\n## Get post list from markdown files\r\n\r\n```javascript\r\n\r\nexport async function getStaticProps() {\r\n  const files = fs.readdirSync(path.join(\"posts\"));\r\n  // read file names from the directory\r\n  // It returns an array\r\n\r\n  const posts = files.map((filename) =\u003e {\r\n\r\n    const slug = filename.replace(\".md\", \"\");\r\n    const markdownWithMeta = fs.readFileSync(\r\n      path.join(\"posts\", filename),\r\n      \"utf-8\"\r\n    );\r\n    const { data: frontMatter, content } = matter(markdownWithMeta);\r\n\r\n    return {\r\n      slug,\r\n      ...frontMatter\r\n    };\r\n  });\r\n  // iterate files to get slug, and parse frontMatter of markdown\r\n  // use \"matter\" library to parse markdown\r\n\r\n  return {\r\n    props: {\r\n      posts,\r\n    },\r\n  };\r\n  // return props to React component\r\n}\r\n\r\nexport default function Index({ posts }) {\r\n    ...\r\n}\r\n```\r\n\r\nNow we got an array including slug of each posts. We can route pages with those slugs.\r\n\r\n---\r\n\r\n## Get static path from slug\r\n\r\nIf a page has dynamic routes and uses getStaticProps it needs to define a list of paths that have to be rendered to HTML at build time.\r\n\r\nIf you export an async function called getStaticPaths from a page that uses dynamic routes, Next.js will statically pre-render all the paths specified by getStaticPaths.\r\n\r\n```javascript\r\n// [slug].jsx\r\n// https://localhost:3000/slug\r\n\r\nexport async function getStaticPaths() {\r\n  const files = fs.readdirSync(path.join(\"posts\"));\r\n\r\n  const paths = files.map((filename) =\u003e ({\r\n    params: {\r\n      slug: filename.replace(\".md\", \"\"),\r\n    },\r\n  }));\r\n\r\n  return {\r\n    paths,\r\n    fallback: true,\r\n  };\r\n}\r\n// define a list of paths\r\n```\r\n\r\n---\r\n\r\n## Parse markdown to html and render\r\n\r\n```javascript\r\n// [slug].jsx\r\n\r\n...\r\n\r\nexport async function getStaticProps({ params: { slug } }) {\r\n  const markdownWithMeta = fs.readFileSync(\r\n    path.join(\"posts\", slug + \".md\"),\r\n    \"utf-8\"\r\n  );\r\n// get a single markdown file with a slug\r\n\r\n  const { data: frontMatter, content } = matter(markdownWithMeta);\r\n// parse the markdown file\r\n\r\n  return {\r\n    props: { frontMatter, content },\r\n  };\r\n}\r\n// return props to a React Component\r\n// content is html\r\n\r\nexport default function Blog({ frontMatter: { title }, content}) {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003ch1\u003e{title}\u003c/h1\u003e\r\n      \u003cdiv className={styles.content}\u003e\r\n        \u003cReactMarkdown\u003e{content}\u003c/ReactMarkdown\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n// Render html with \"markdown\" library\r\n```\r\n\r\n---\r\n\r\n## Configuration\r\n\r\nTo generate static site, and deploy to CDN, we can set up an asset Prefix and configure the CDN's origin to resolve to the domain that Next.js is hosted on.\r\n\r\n```javascript\r\n// next.config.js\r\n\r\nconst isProd = process.env.NODE_ENV === \"production\";\r\n\r\nmodule.exports = {\r\n  // Use the CDN in production and localhost for development.\r\n  assetPrefix: isProd ? \"https://cdn.mydomain.com\" : \"\",\r\n};\r\n```\r\n\r\nAnd I imported the assetPrest to fix image links between pages.\r\n\r\n```javascript\r\n// _app.js\r\n\r\nimport { assetPrefix } from \"../next.config\";\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  const date = new Date();\r\n  return (\r\n      \u003cComponent {...pageProps} prefix={assetPrefix} /\u003e\r\n  );\r\n}\r\nexport default MyApp;\r\n\r\n// other pages\r\n\u003cimg src={prefix + \"imgSrc\"}\u003e\r\n```\r\n\r\n---\r\n\r\n## References\r\n\r\n- [https://nextjs.org/](https://nextjs.org/)\r\n- [hhttps://dev.to/jameswallis/](https://dev.to/jameswallis/deploying-a-next-js-app-to-github-pages-24pn)\r\n"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"build_next.js_blog_and_deploy_to_github_pages"},"buildId":"IcFg2rTd2QAX5NcgMIzP8","assetPrefix":"https://waynechoi.dev","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>