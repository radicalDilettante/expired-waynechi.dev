<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Build Next.js blog and deploy to Github Pages - WayneChoi.dev</title><meta name="author" content="Wayne Choi"/><meta name="description" content="How I build static blog site with Next.js, and general configuration to deploy to Github Pages in this post..."/><meta name="keywords" content="React,Deploy"/><meta name="next-head-count" content="6"/><link rel="preload" href="https://waynechoi.dev/_next/static/css/a4a2eb3c6228baf493b9.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/a4a2eb3c6228baf493b9.css" data-n-g=""/><link rel="preload" href="https://waynechoi.dev/_next/static/css/cde35213adb84359b33a.css" as="style"/><link rel="stylesheet" href="https://waynechoi.dev/_next/static/css/cde35213adb84359b33a.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://waynechoi.dev/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="https://waynechoi.dev/_next/static/chunks/webpack-d485bbc1d791f1a283b8.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/framework-b97a0ed4f13ff8397343.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/main-c4f2541b93e4ae8b71f8.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/_app-bc781eda49c3fa74d5c0.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/610-041eb31b214f3f448fbb.js" defer=""></script><script src="https://waynechoi.dev/_next/static/chunks/pages/%5Bslug%5D-e222e7756b964d9823fd.js" defer=""></script><script src="https://waynechoi.dev/_next/static/mWOa3K8bHiCI7Nm2jAixL/_buildManifest.js" defer=""></script><script src="https://waynechoi.dev/_next/static/mWOa3K8bHiCI7Nm2jAixL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout_container__1ROar"><header class="layout_header__MPs9E"><div class="header_container__2Vvjg"><div class="header_header__3lGRs"><button class="header_mobileMenuButton__1vVY8"><img alt="menu" src="https://waynechoi.dev/images/menu.svg"/></button><a class="header_name__2PEvs" href="/">WayneChoi.dev</a><ul class="header_list__2sooW"><li class="header_item_list_item__33J-y"><a href="/">HOME</a></li><li class="header_item_list_item__33J-y"><a href="/about">ABOUT</a></li><li class="header_item_list_item__33J-y"><a href="/portfolio">PORTFOLIO</a></li></ul><div class="header_searchBar__3VAZB"><form class="search_bar_container__2559w"><input type="text" id="keyword" placeholder="keywords..." required=""/><button type="submit"><img alt="search" src="https://waynechoi.dev/images/search.svg"/></button></form></div><button class="header_mobileSearchButton__1r9xs"><img alt="search" src="https://waynechoi.dev/images/search.svg"/></button></div></div></header><section class="layout_contents__wGaub"><div class="blog_container__3EBzV"><div class="blog_tagWrapper__sYhAm"><span class="blog_tag__2jFK0">#<!-- -->React</span><span class="blog_tag__2jFK0">#<!-- -->Deploy</span></div><h1 class="blog_h1__3s5r-">Build Next.js blog and deploy to Github Pages</h1><span class="blog_date__2SU8B">Sep 10, 2021</span><div class="blog_content__mgCMi"><div><div>
<p>Next.js was known as a React framework to support server-side rendering (SSR) with zero config(if not necessary). After recent updates, it supports static generation (SSG) well, too.</p><p>To build my own blog, I got two options for React frameworks, one was Next.js, and other was Gatsby. I want to export my blog to static files, and Gatsby is specialized for SSG though, I choose Next.js. There was no reason for me to choose new tech stack, because I already tried Next.js before(for SSR), and I heard SSG in Next.js performs well.</p><p>I deployed the static files of my blog to Github Pages, and I needed some configuration. I would record how I built static blog site with Next.js, and general configuration to deploy to Github Pages in this post.</p><hr/><h2 id="table-of-contents">Table of Contents</h2><ul><li>Write posts with markdown format</li><li>Get slugs from markdown files</li><li>define path list from slugs</li><li>Parse markdown to html</li><li>Configuration</li></ul><p>My code is modularized though, I put all code together in this post to make it easy to explain.</p><p>I will skip to import all libraries. The dependency is blow.</p><pre><code class="lang-javascript"> &quot;dependencies&quot;: {
    &quot;gh-pages&quot;: &quot;^3.2.3&quot;,
    &quot;gray-matter&quot;: &quot;^4.0.3&quot;,
    &quot;next&quot;: &quot;^11.1.2&quot;,
    &quot;react&quot;: &quot;17.0.2&quot;,
    &quot;react-dom&quot;: &quot;17.0.2&quot;,
    &quot;react-markdown&quot;: &quot;^6.0.3&quot;,
    &quot;react-syntax-highlighter&quot;: &quot;^15.4.4&quot;
  }</code></pre><hr/><h2 id="get-post-list-from-markdown-files">Get post list from markdown files</h2><pre><code class="lang-javascript">
export async function getStaticProps() {
  const files = fs.readdirSync(path.join(&quot;posts&quot;));
  // read file names from the directory
  // It returns an array

  const posts = files.map((filename) =&gt; {

    const slug = filename.replace(&quot;.md&quot;, &quot;&quot;);
    const markdownWithMeta = fs.readFileSync(
      path.join(&quot;posts&quot;, filename),
      &quot;utf-8&quot;
    );
    const { data: frontMatter, content } = matter(markdownWithMeta);

    return {
      slug,
      ...frontMatter
    };
  });
  // iterate files to get slug, and parse frontMatter of markdown
  // use &quot;matter&quot; library to parse markdown

  return {
    props: {
      posts,
    },
  };
  // return props to React component
}

export default function Index({ posts }) {
    ...
}</code></pre><p>Now we got an array including slug of each posts. We can route pages with those slugs.</p><hr/><h2 id="get-static-path-from-slug">Get static path from slug</h2><p>If a page has dynamic routes and uses getStaticProps it needs to define a list of paths that have to be rendered to HTML at build time.</p><p>If you export an async function called getStaticPaths from a page that uses dynamic routes, Next.js will statically pre-render all the paths specified by getStaticPaths.</p><pre><code class="lang-javascript">// [slug].jsx
// https://localhost:3000/slug

export async function getStaticPaths() {
  const files = fs.readdirSync(path.join(&quot;posts&quot;));

  const paths = files.map((filename) =&gt; ({
    params: {
      slug: filename.replace(&quot;.md&quot;, &quot;&quot;),
    },
  }));

  return {
    paths,
    fallback: true,
  };
}
// define a list of paths</code></pre><hr/><h2 id="parse-markdown-to-html-and-render">Parse markdown to html and render</h2><pre><code class="lang-javascript">// [slug].jsx

...

export async function getStaticProps({ params: { slug } }) {
  const markdownWithMeta = fs.readFileSync(
    path.join(&quot;posts&quot;, slug + &quot;.md&quot;),
    &quot;utf-8&quot;
  );
// get a single markdown file with a slug

  const { data: frontMatter, content } = matter(markdownWithMeta);
// parse the markdown file

  return {
    props: { frontMatter, content },
  };
}
// return props to a React Component
// content is html

export default function Blog({ frontMatter: { title }, content}) {
  return (
    &lt;div&gt;
      &lt;h1&gt;{title}&lt;/h1&gt;
      &lt;div className={styles.content}&gt;
        &lt;ReactMarkdown&gt;{content}&lt;/ReactMarkdown&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
// Render html with &quot;markdown&quot; library</code></pre><hr/><h2 id="configuration">Configuration</h2><p>To generate static site, and deploy to CDN, we can set up an asset Prefix and configure the CDN&#x27;s origin to resolve to the domain that Next.js is hosted on.</p><pre><code class="lang-javascript">// next.config.js

const isProd = process.env.NODE_ENV === &quot;production&quot;;

module.exports = {
  // Use the CDN in production and localhost for development.
  assetPrefix: isProd ? &quot;https://cdn.mydomain.com&quot; : &quot;&quot;,
};</code></pre><p>And I imported the assetPrest to fix image links between pages.</p><pre><code class="lang-javascript">// _app.js

import { assetPrefix } from &quot;../next.config&quot;;

function MyApp({ Component, pageProps }) {
  const date = new Date();
  return (
      &lt;Component {...pageProps} prefix={assetPrefix} /&gt;
  );
}
export default MyApp;

// other pages
&lt;img src={prefix + &quot;imgSrc&quot;}&gt;</code></pre><hr/><h2 id="references">References</h2><ul><li><a href="https://nextjs.org/">https://nextjs.org/</a></li><li><a href="https://dev.to/jameswallis/deploying-a-next-js-app-to-github-pages-24pn">hhttps://dev.to/jameswallis/</a></li></ul></div></div></div><div id="utterances_container"></div></div></section><footer class="layout_footer__2KiKH">(C) <!-- -->2021<!-- -->. Wonjun Choi. All rights reserved.</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"Build Next.js blog and deploy to Github Pages","date":"Sep 10, 2021","tag":["React","Deploy"],"excerpt":"How I build static blog site with Next.js, and general configuration to deploy to Github Pages in this post..."},"content":"\r\nNext.js was known as a React framework to support server-side rendering (SSR) with zero config(if not necessary). After recent updates, it supports static generation (SSG) well, too.\r\n\r\nTo build my own blog, I got two options for React frameworks, one was Next.js, and other was Gatsby. I want to export my blog to static files, and Gatsby is specialized for SSG though, I choose Next.js. There was no reason for me to choose new tech stack, because I already tried Next.js before(for SSR), and I heard SSG in Next.js performs well.\r\n\r\nI deployed the static files of my blog to Github Pages, and I needed some configuration. I would record how I built static blog site with Next.js, and general configuration to deploy to Github Pages in this post.\r\n\r\n---\r\n\r\n## Table of Contents\r\n\r\n- Write posts with markdown format\r\n- Get slugs from markdown files\r\n- define path list from slugs\r\n- Parse markdown to html\r\n- Configuration\r\n\r\nMy code is modularized though, I put all code together in this post to make it easy to explain.\r\n\r\nI will skip to import all libraries. The dependency is blow.\r\n\r\n```javascript\r\n \"dependencies\": {\r\n    \"gh-pages\": \"^3.2.3\",\r\n    \"gray-matter\": \"^4.0.3\",\r\n    \"next\": \"^11.1.2\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n    \"react-markdown\": \"^6.0.3\",\r\n    \"react-syntax-highlighter\": \"^15.4.4\"\r\n  }\r\n```\r\n\r\n---\r\n\r\n## Get post list from markdown files\r\n\r\n```javascript\r\n\r\nexport async function getStaticProps() {\r\n  const files = fs.readdirSync(path.join(\"posts\"));\r\n  // read file names from the directory\r\n  // It returns an array\r\n\r\n  const posts = files.map((filename) =\u003e {\r\n\r\n    const slug = filename.replace(\".md\", \"\");\r\n    const markdownWithMeta = fs.readFileSync(\r\n      path.join(\"posts\", filename),\r\n      \"utf-8\"\r\n    );\r\n    const { data: frontMatter, content } = matter(markdownWithMeta);\r\n\r\n    return {\r\n      slug,\r\n      ...frontMatter\r\n    };\r\n  });\r\n  // iterate files to get slug, and parse frontMatter of markdown\r\n  // use \"matter\" library to parse markdown\r\n\r\n  return {\r\n    props: {\r\n      posts,\r\n    },\r\n  };\r\n  // return props to React component\r\n}\r\n\r\nexport default function Index({ posts }) {\r\n    ...\r\n}\r\n```\r\n\r\nNow we got an array including slug of each posts. We can route pages with those slugs.\r\n\r\n---\r\n\r\n## Get static path from slug\r\n\r\nIf a page has dynamic routes and uses getStaticProps it needs to define a list of paths that have to be rendered to HTML at build time.\r\n\r\nIf you export an async function called getStaticPaths from a page that uses dynamic routes, Next.js will statically pre-render all the paths specified by getStaticPaths.\r\n\r\n```javascript\r\n// [slug].jsx\r\n// https://localhost:3000/slug\r\n\r\nexport async function getStaticPaths() {\r\n  const files = fs.readdirSync(path.join(\"posts\"));\r\n\r\n  const paths = files.map((filename) =\u003e ({\r\n    params: {\r\n      slug: filename.replace(\".md\", \"\"),\r\n    },\r\n  }));\r\n\r\n  return {\r\n    paths,\r\n    fallback: true,\r\n  };\r\n}\r\n// define a list of paths\r\n```\r\n\r\n---\r\n\r\n## Parse markdown to html and render\r\n\r\n```javascript\r\n// [slug].jsx\r\n\r\n...\r\n\r\nexport async function getStaticProps({ params: { slug } }) {\r\n  const markdownWithMeta = fs.readFileSync(\r\n    path.join(\"posts\", slug + \".md\"),\r\n    \"utf-8\"\r\n  );\r\n// get a single markdown file with a slug\r\n\r\n  const { data: frontMatter, content } = matter(markdownWithMeta);\r\n// parse the markdown file\r\n\r\n  return {\r\n    props: { frontMatter, content },\r\n  };\r\n}\r\n// return props to a React Component\r\n// content is html\r\n\r\nexport default function Blog({ frontMatter: { title }, content}) {\r\n  return (\r\n    \u003cdiv\u003e\r\n      \u003ch1\u003e{title}\u003c/h1\u003e\r\n      \u003cdiv className={styles.content}\u003e\r\n        \u003cReactMarkdown\u003e{content}\u003c/ReactMarkdown\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  );\r\n}\r\n// Render html with \"markdown\" library\r\n```\r\n\r\n---\r\n\r\n## Configuration\r\n\r\nTo generate static site, and deploy to CDN, we can set up an asset Prefix and configure the CDN's origin to resolve to the domain that Next.js is hosted on.\r\n\r\n```javascript\r\n// next.config.js\r\n\r\nconst isProd = process.env.NODE_ENV === \"production\";\r\n\r\nmodule.exports = {\r\n  // Use the CDN in production and localhost for development.\r\n  assetPrefix: isProd ? \"https://cdn.mydomain.com\" : \"\",\r\n};\r\n```\r\n\r\nAnd I imported the assetPrest to fix image links between pages.\r\n\r\n```javascript\r\n// _app.js\r\n\r\nimport { assetPrefix } from \"../next.config\";\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  const date = new Date();\r\n  return (\r\n      \u003cComponent {...pageProps} prefix={assetPrefix} /\u003e\r\n  );\r\n}\r\nexport default MyApp;\r\n\r\n// other pages\r\n\u003cimg src={prefix + \"imgSrc\"}\u003e\r\n```\r\n\r\n---\r\n\r\n## References\r\n\r\n- [https://nextjs.org/](https://nextjs.org/)\r\n- [hhttps://dev.to/jameswallis/](https://dev.to/jameswallis/deploying-a-next-js-app-to-github-pages-24pn)\r\n"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"build_next.js_blog_and_deploy_to_github_pages"},"buildId":"mWOa3K8bHiCI7Nm2jAixL","assetPrefix":"https://waynechoi.dev","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>