<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>State management with Class in React - WayneChoi.dev</title><meta name="author" content="Wayne Choi"/><meta name="description" content="To implement global state management with class and dependency injection in React application."/><meta name="keywords" content="React,Architecture"/><meta name="next-head-count" content="6"/><link rel="preload" href="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/css/dd81c86663b99a7f14a1.css" as="style"/><link rel="stylesheet" href="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/css/dd81c86663b99a7f14a1.css" data-n-g=""/><link rel="preload" href="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/css/81065f7f6327d4b5d267.css" as="style"/><link rel="stylesheet" href="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/css/81065f7f6327d4b5d267.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/webpack-12964ea9dded4c03389e.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/main-c4f2541b93e4ae8b71f8.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/pages/_app-34fe782ae15055e0b470.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/113-578803495dd2b122acd7.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/chunks/pages/%5Bslug%5D-359e4aa19627ad0c9516.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/_oyi5A3FM9BzpCFmR9tgR/_buildManifest.js" defer=""></script><script src="https://radicaldilettante.github.io/expired-waynechi.dev/_next/static/_oyi5A3FM9BzpCFmR9tgR/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="style_container__1fUIW"><header class="style_header__1vTJ4 theme_light__2lu4I"><div class="style_container__3a_wR"><div class="style_header__1ynE4"><button class="style_mobileMenuButton__1APOa"><img alt="open_menu_bar" src="https://radicaldilettante.github.io/expired-waynechi.dev/images/menu.svg"/></button><a class="style_name__c3MEE" href="/">WayneChoi.dev</a><ul class="style_list__chEFJ"><li><div><a href="/">HOME</a></div></li><li><div><a href="/about">ABOUT</a></div></li><li><div><a href="/portfolio">PORTFOLIO</a></div></li><li><div><a href="/cv" target="_blank">CV</a></div></li><li><button class="style_cliButton__3JcSL"><img src="https://radicaldilettante.github.io/expired-waynechi.dev/images/cli.png" alt="cli_mode"/></button></li></ul><div class="style_searchBar__FDBv7"><form class="style_container__j4rCB theme_light__2lu4I"><input type="text" id="keyword" placeholder="keywords..." required="" class="theme_light__2lu4I"/><button type="submit"><img alt="search" src="https://radicaldilettante.github.io/expired-waynechi.dev/images/search.svg"/></button></form></div><button class="style_mobileSearchButton__1AMGz"><img alt="open_search_bar" src="https://radicaldilettante.github.io/expired-waynechi.dev/images/search.svg"/></button></div></div></header><section class="style_contents__1dCqS"><div class="blog_container__2sPBE"><div class="blog_tagWrapper__1MSFu"><span class="blog_tag__3CYz_">#<!-- -->React</span><span class="blog_tag__3CYz_">#<!-- -->Architecture</span></div><h1 class="blog_h1__3a0RO">State management with Class in React</h1><span class="blog_date__3Pnjx">Mar 18, 2022</span><div class="blog_content__2NI78"><div class="style_container__2jJTZ"></div></div></div></section><footer class="style_footer__1H40h">(C) <!-- -->2022<!-- -->. Wonjun Choi. All rights reserved.</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"State management with Class in React","date":"Mar 18, 2022","tag":["React","Architecture"],"excerpt":"To implement global state management with class and dependency injection in React application.","content":"\nI implemented a global state management to deal with JWT token and local storage in React application. This post is to share my concerns and how I solved them. The module is class-based. A React library to manage global statement, and window object to get and set local storage are injected from outside the class.\n\n## Why class?\n\nI struggled between class(to deal with action and status together) and function(with objects literal) to manage statements in this application.\n\nIf I decoupled to reduce dependence with class, it makes better maintainability, and easier test code. At the same time, it costs a lot to convert states from the class instance to the React library, and even from the React library to the class instance.\n\nThere are various of dependency for frontend application, such as DOM, React libraries, and window object, so if it is decoupled too deep, the complexity of the application increases incredibly. So, I normally prefer not to use class to manage statement in frontend application.\n\nHowever, I picked class and dependency injection for this case. All the action about authentication shares same statement, so I thought it costs more to inject all the dependency into every single function. The other reason was that the storage to store user information is different depend on user option. It would be better to be abstracted.\n\n## Recoil?\n\nEven if I manipulate the states in the class, I need to update states of a React library, because the members in the class does not affect DOM rendering in real time.\n\nI choose Recoil at first. But there was an issue. I can only access Recoil atoms in the RecoilRoot component. That means I cannot inject all methods to update Recoil atoms in main component. So I made the Initializer component under RecoilRoot component, and inject all the dependency with an initialization method in Initializer component.\n\n```typescript\n//app.tsx\nfunction MyApp({ Component, pageProps }: AppProps) {\n  const date = new Date();\n  const auth = AuthService.getInstance(urlBase);\n\n  return (\n    \u003cRecoilRoot\u003e\n      \u003cInitializer auth={auth} date={date} /\u003e\n      \u003cLayout date={date} auth={auth}\u003e\n        \u003cComponent {...pageProps} auth={auth} urlBase={urlBase} /\u003e\n      \u003c/Layout\u003e\n    \u003c/RecoilRoot\u003e\n  );\n}\n\n//initializer.tsx\nimport { useEffect } from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport { authState } from \"../../../atoms/auth\";\nimport { tokenState } from \"../../../atoms/token\";\nimport AuthService from \"../../../utils/modules/auth\";\n\ninterface IProps {\n  auth: AuthService;\n  date: Date;\n}\n\nexport default function Initializer({ auth, date }: IProps) {\n  const [token, setToken] = useRecoilState(tokenState);\n  const [isAuthorized, setIsAuthorized] = useRecoilState(authState);\n  useEffect(() =\u003e {\n    auth.init(setToken, setIsAuthorized, window, date);\n  }, []);\n  return \u003c\u003e\u003c/\u003e;\n}\n```\n\nIt is too complex. I thought about another alternative.\n\n## Context API\n\nThe higher the level of abstraction, the more difficult it is to customize. I decided to replace Recoil with context API. I did not use FLUX pattern which is the most commonly used with context API, but new pattern.\n\nIn the FLUX pattern, both action and states are injected to a Provider. I abstracted all the action to manage state in context with injecting into the class instance, and injected only states and the class instance to a Provider. I mean that it is to decouple all the state management logics.\n\n```typescript\nimport { createContext, ReactChild, useEffect, useState } from \"react\";\nimport AuthService, { AuthStatus } from \"../../services/auth/auth\";\n\nexport interface AuthProviderValue extends AuthStatus {\n  service: AuthService;\n}\nconst authServiceInstance = AuthService.getInstance();\nconst initialStatus: AuthStatus = { token: \"\", isAuth: \"\" };\nconst initialValue: AuthProviderValue = {\n  ...initialStatus,\n  service: authServiceInstance,\n};\n\nexport const authContext = createContext\u003cAuthProviderValue\u003e(initialValue);\n\ninterface IProps {\n  children: ReactChild;\n  urlBase: string;\n}\n\nconst AuthProvider = ({ children, urlBase }: IProps) =\u003e {\n  const [status, setStatus] = useState\u003cAuthStatus\u003e(initialStatus);\n\n  const date = new Date();\n  useEffect(() =\u003e {\n    authServiceInstance?.init(urlBase, window, date, setStatus);\n  }, []);\n\n  const value = {\n    service: authServiceInstance,\n    token: status.token,\n    isAuth: status.isAuth,\n  };\n\n  return \u003cauthContext.Provider value={value}\u003e{children}\u003c/authContext.Provider\u003e;\n};\n\nexport default AuthProvider;\n```\n"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"state_management_with_class_in_react"},"buildId":"_oyi5A3FM9BzpCFmR9tgR","assetPrefix":"https://radicaldilettante.github.io/expired-waynechi.dev","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>